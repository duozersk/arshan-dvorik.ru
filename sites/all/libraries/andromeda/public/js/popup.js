(function($){samo.popup=function(content,options){var self=this;self.content=content||'';self.options=$.extend({destroy:false,header:false,close:function(){}},options);self.set=function(value){self.content=value;self.$body.find('div.samo_popup_container').html(self.content);return self;};var _destroy=function(){self.$body.remove();self.$veil.remove();delete self;}
var _hide=function(){self.$body.hide();self.$veil.hide();};self.close=function(){_hide();self.options.close();if(self.options.destroy){_destroy();}}
self.hide=function(){self.close();}
self.show=function(){var content=arguments[0]||'';if(content){self.set(content);}
if(self.content){self.$body.fadeIn();if(!document.all){self.$veil.fadeIn();}else{self.$veil.show();}
self.realign();}
return self;};self.realign=function(){if(self.content==''||!self.$body.is(':visible'))return;var $form=self.$body;var $veil=self.$veil;var cont=$form.find('.samo_popup_container');cont=cont.size()?cont:$form;var wndWidth=$(window).width();var wndHeight=$(window).height();var contWidth=0;var contHeight=0;var formWidth=0;var formHeight=0;var resetSizes=function(){contWidth=cont.outerWidth();contHeight=cont.outerHeight();formWidth=$form.outerWidth();formHeight=$form.outerHeight();};var w=self.options.width?self.options.width:0.8;resetSizes();if(formHeight>wndHeight*w){cont.css({overflowY:'auto',height:Math.round(wndHeight*w)-(formHeight-contHeight)});}
resetSizes();if(formWidth>wndWidth*w){cont.css({overflowX:'auto',width:Math.round(wndWidth*w)-(formWidth-contWidth)});}
resetSizes();var y=parseInt(document.body.scrollTop||document.documentElement.scrollTop)+Math.round(wndHeight/2-formHeight/2);var x=parseInt(document.body.scrollLeft||document.documentElement.scrollLeft)+Math.round(wndWidth/2-formWidth/2);$form.css('top',y).css('left',x);$veil.css('height',$(document).height());};self.init=function(content){self.$body=$('<div class="samo_popup" style="display: none;"><table>'+'<tr><td><div class="samo_popup_header"></div></td><td><div class="samo_popup_close_form">Закрыть</div></td></tr>'+'<tr><td colspan="2"><div class="samo_popup_container"></div></td></tr>'+'</table></div>');$('body').append(self.$body);self.$body.find('div.samo_popup_close_form').on('click',self.close);self.$veil=$('<div class="samo_veil" style="display: none;"></div>').on('click',self.close);$('body').append(self.$veil);$(window).bind('scroll resize',function(){self.realign();});self.set(content);if(self.options.header){self.$body.find('div.samo_popup_header').html(self.options.header);}};self.init(self.content);return self;}})(samo.jQuery);