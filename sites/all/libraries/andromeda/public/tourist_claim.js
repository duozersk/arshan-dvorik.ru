if(typeof samo==='undefined'){samo={};}
var samo_tourist_claim={_AGENT:null,_DATASOURCE:'',_VERSION:'1.1',_PARAMS:{},_ACTION:'',_CLAIM:0,_EMAIL:'',_TOURIST_CLAIM:null,_TOURIST_CLAIM_FAST:false,AUTHED:false,A_CLICK:false,INSTRUCTION:null,AUTH_BY_KEY:false,_LAST_PARAMS:{},_DOFUNC:null,_NOSLIDE:false,jsonCallbackStart:new Date()-0,ajaxStart:false,CLAIM_LIST:false};$.loadData=function(action,params,callback){if(samo_tourist_claim.ajaxStart)return;if(action!='tourist_auth'){samo_tourist_claim._LAST_PARAMS=params;}
params=params?params:{};$.each(params,function(i,e){if(!e){delete params[i];}});params.action=action;params.AGENT=samo_tourist_claim._AGENT;params.uid=params.AGENT;params.CLAIM=samo_tourist_claim._CLAIM;samo_tourist_claim._ACTION=action;var url=samo_tourist_claim._DATASOURCE+'action='+samo_tourist_claim._ACTION+'&version='+samo_tourist_claim._VERSION;samo_tourist_claim.ajaxStart=true;$.ajax({type:'GET',url:url,data:params,success:callback?callback:samo_tourist_claim.response,dataType:'jsonp',json:false,jsonpCallback:'jsonp'+(samo_tourist_claim.jsonCallbackStart++)});}
samo_tourist_claim.message=function(text,type){if(!samo_tourist_claim.AUTHED&&type=='error'&&!samo_tourist_claim._TOURIST_CLAIM_FAST){samo_tourist_claim.show_global_error(text);}else{if(type=='error'){text='Ошибка!'+'\n\n'+text;}
alert(text);}}
samo_tourist_claim.tourist_claim_auth=function(){var EMAIL=$.trim(samo_tourist_claim._TOURIST_CLAIM.find('input[name=EMAIL]').val());var PSW=$.trim(samo_tourist_claim._TOURIST_CLAIM.find('input[name=PSW]').val());if(PSW==''||EMAIL==''){samo_tourist_claim.message(samo_tourist_claim.msg('enterEmailAndPassword'),'error');return;}
var NONCE=String(Math.round(Math.random()*0xFFFFFF)).md5();PSW=String(PSW.md5()+NONCE).md5();var url=samo_tourist_claim._TOURIST_CLAIM.attr('samo:datasource');$.loadData('tourist_auth',{EMAIL:EMAIL,PSW:PSW,NONCE:NONCE},samo_tourist_claim.after_auth);}
samo_tourist_claim.show_global_error=function(error){$('#authed').replaceWith('<div class="tourist_claim_error">'+error+'</div>');}
samo_tourist_claim.msg=function(name,def){return samo_tourist_claim._relation('messages',name,def);}
samo_tourist_claim.show_pays=function(){samo_tourist_claim.remove_replacers();$.loadData('tourist_pay',{CLAIM:samo_tourist_claim._CLAIM,AGENT:samo_tourist_claim._AGENT});}
samo_tourist_claim.check_data=function(data){samo_tourist_claim.ajaxStart=false;var fast=samo_tourist_claim._TOURIST_CLAIM_FAST;var lo=false;if(data.error){var code=data.code;var auth_error=code==3;var key_error=code==4;if(samo_tourist_claim.AUTH_BY_KEY&&key_error){samo_tourist_claim.show_global_error(samo_tourist_claim.msg('wrongKey',data.error));return false;}
if(samo_tourist_claim.AUTH_BY_KEY&&auth_error){if(samo_tourist_claim._ACTION!='tourist_auth'){var ac=samo_tourist_claim._ACTION;samo_tourist_claim.login();samo_tourist_claim._DOFUNC=function(){samo_tourist_claim._ACTION=ac;$.loadData(ac,samo_tourist_claim._LAST_PARAMS);}
return false;}else{samo_tourist_claim.show_global_error(samo_tourist_claim.msg('wrongKey',data.error));return false;}}
if(!fast&&auth_error){lo=true;}
if(fast||(!auth_error||samo_tourist_claim.AUTHED)){samo_tourist_claim.message(data.error,'error');}
if(lo){samo_tourist_claim.logout();}
return false;}
return true;}
samo_tourist_claim.after_auth=function(data){if(!samo_tourist_claim.check_data(data))return false;if(samo_tourist_claim.AUTH_BY_KEY)return false;var w=window.parent?(window.parent!=self?window.parent:self):self;document.cookie='buyerEmail='+samo_tourist_claim._TOURIST_CLAIM.find('input[name=EMAIL]').val();w.location.href=samo.settings.tourist_claim.LOGIN_URL;}
$(document).ready(function(){if(typeof $.ajaxPrefilter=='function'){$.ajaxPrefilter(function(options){options.global=true;});}
samo_tourist_claim._TOURIST_CLAIM=$('#tourist_claim');samo_tourist_claim._TOURIST_CLAIM_FAST=parseInt(samo_tourist_claim._TOURIST_CLAIM.attr('samo:fast'))==1;samo_tourist_claim._DATASOURCE=samo_tourist_claim._TOURIST_CLAIM.attr('samo:datasource');samo_tourist_claim._AGENT=samo_tourist_claim._TOURIST_CLAIM.attr('samo:agent');var buyerEmail=document.cookie.match(/buyerEmail=.*?;/g);if(buyerEmail&&buyerEmail.length){buyerEmail=buyerEmail[0].split('=');if(buyerEmail.length==2){buyerEmail=buyerEmail[1];buyerEmail=buyerEmail.replace(/;/g,'');samo_tourist_claim._TOURIST_CLAIM.find('input[name=EMAIL]').val(buyerEmail);}}
$('body').append('<div id="preloader" style="z-index: 1020;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Загрузка&nbsp;данных&hellip;</div>');$('#preloader').bind('ajaxStart ajaxStop',function(e){if(e.type=='ajaxStart'){$(this).show();}else{$(this).hide();}});samo_tourist_claim._TOURIST_CLAIM.bind('ajaxStart ajaxStop',function(e){$(this).find('button').attr('disabled',e.type=='ajaxStart'?'disabled':'');});$.ajaxSetup({error:function(xhr,status,e){if('timeout'==status){samo_tourist_claim.message(samo_tourist_claim.msg('responseTimeout'),'error');}},timeout:60000,scriptCharset:'utf-8',dataType:'jsonp'});$('#forgot_password',samo_tourist_claim._TOURIST_CLAIM).bind('click',function(){var email='';if(email=prompt(samo_tourist_claim.msg('enterEmail'),samo_tourist_claim._TOURIST_CLAIM.find('input[name=EMAIL]').val())){$.loadData('forgot_buyer_psw',{email:email},function(data){if(!samo_tourist_claim.check_data(data))return;samo_tourist_claim.message(samo_tourist_claim.msg('newPasswordWasSent')+email);samo_tourist_claim._TOURIST_CLAIM.find('input[name=PSW]').focus();});}});});samo_tourist_claim.remove_replacers=function(){$('.replacer').each(function(){if($(this).is('.clone')){$(this).remove();}});}
samo_tourist_claim.update_claim_main_info=function(name,value){samo_tourist_claim._switch_element('.claim_main_info_claim_header_'+name,value);$('.claim_main_info_'+name,samo_tourist_claim._TOURIST_CLAIM).html(value);}
samo_tourist_claim.set_auth_text=function(text,email){$('#authed',samo_tourist_claim._TOURIST_CLAIM).find('#authed_name').html(text);$('#authed',samo_tourist_claim._TOURIST_CLAIM).find('#authed_email').html(email);$('#authed #loading_title',samo_tourist_claim._TOURIST_CLAIM).hide();$('#authed #content_title',samo_tourist_claim._TOURIST_CLAIM).show();}
samo_tourist_claim.show_claim=function(data){samo_tourist_claim.hide_form();if(!data.claim){data={claim:data};}
if(data.claim){try{$('.clone[id!=claim_list_info]',samo_tourist_claim._TOURIST_CLAIM).remove();var claimDocument=data.claim.claimDocument[0];var _status=claimDocument.status;var _payStatus=claimDocument.payStatus;if(data.claim_inc){samo_tourist_claim._CLAIM=data.claim_inc;}
var provider=claimDocument.provider?claimDocument.provider[0]:null;var transports=claimDocument.transports?claimDocument.transports[0].transport:null;var moneys=claimDocument.moneys?claimDocument.moneys[0].money:null;var services=claimDocument.services?claimDocument.services[0].service:null;var hotels=claimDocument.hotels?claimDocument.hotels[0].hotel:null;var peoples=claimDocument.peoples?claimDocument.peoples[0].people:null;var buyer=claimDocument.buyer?samo_tourist_claim._people_fields(claimDocument.buyer[0]):null;var common=claimDocument;var additional=data.claim.additional?data.claim.additional[0]:null;var st='';if(_status=='csNotActivated'||_status=='csNotReaded'||_status=='csProcessed'){st='accepted';}else if(_status=='csUnconfirmed'||_status=='csCancelled'||_status=='csAwaitingCancel'){st='cancelled';}else if(_status=='csConfirmed'){st='confirmed';}
if(st=='confirmed'&&_payStatus=='psPaid'){st='paid';common.status=samo_tourist_claim._claim_paystatus('psPaid');}else{common.status=samo_tourist_claim._claim_status(common.status);}
common.datebeg=samo_tourist_claim._date_format(common.datebeg);common.dateend=samo_tourist_claim._date_format(common.dateend);common.cdate=samo_tourist_claim._date_format(common.cdate,true);common.provider=provider?provider.name:null;common.condition=samo_tourist_claim._claim_condition(common.condition);common.payStatus=samo_tourist_claim._claim_paystatus(common.payStatus);common.note=common.note?common.note[0]._:null;common.paid=data.claim.paid?data.claim.paid[0]._:null;common.paidCurrency=data.claim.paidCurrency?data.claim.paidCurrency[0]._:null;if(typeof claimDocument.buyerMoneys!='undefined'){var buyerClaimMoney=claimDocument.buyerMoneys[0].buyerClaimMoney[0];common.price=buyerClaimMoney.net;common.currency=buyerClaimMoney.currency;}
samo_tourist_claim._switch_element('.showhide_provider',common.provider);samo_tourist_claim._switch_element('.showhide_price',common.price);samo_tourist_claim._switch_element('.showhide_pay',data.claim.showPayVariants);samo_tourist_claim._switch_element('.showhide_all_claims',!samo_tourist_claim.AUTH_BY_KEY);if(transports){$.each(transports,function(i,e){var people_list=e.clients?samo_tourist_claim._get_people_list(e.clients[0].client):[null,null];e.type=samo_tourist_claim._relation('transport_type',e.type);e.arrival_town=e.arrival[0].town;e.arrival_state=e.arrival[0].state;e.arrival_port=e.arrival[0].port;e.arrival_time=e.arrival[0].time;e.departure_town=e.departure[0].town;e.departure_state=e.departure[0].state;e.departure_port=e.departure[0].port;e.departure_time=e.departure[0].time;e.people_list=people_list[0];e.datebeg=samo_tourist_claim._date_format(e.datebeg);e.dateend=samo_tourist_claim._date_format(e.dateend);e.people_count=people_list[1];});}
if(services){$.each(services,function(i,e){if(e.hidden==='true'){delete services[i];}else{var people_list=e.clients?samo_tourist_claim._get_people_list(e.clients[0].client):[null,null];e.type=samo_tourist_claim._relation('service_type',e.type);e.datebeg=samo_tourist_claim._date_format(e.datebeg);e.dateend=samo_tourist_claim._date_format(e.dateend);e.people_list=people_list[0];e.people_count=people_list[1];}});}
if(hotels){$.each(hotels,function(i,e){var people_list=e.clients?samo_tourist_claim._get_people_list(e.clients[0].client):[null,null];e.datebeg=samo_tourist_claim._date_format(e.datebeg);e.dateend=samo_tourist_claim._date_format(e.dateend);e.people_list=people_list[0];e.people_count=people_list[1];});}
if(peoples){$.each(peoples,function(i,e){e=samo_tourist_claim._people_fields(e);});}
$('.show_documents',samo_tourist_claim._TOURIST_CLAIM).show();$('.show_pay',samo_tourist_claim._TOURIST_CLAIM).show();$('.show_on_claim',samo_tourist_claim._TOURIST_CLAIM).show();$('a[name=#claim]',samo_tourist_claim._TOURIST_CLAIM).get(0).scrollIntoView();var replacements={};replacements.common=common;replacements.people=peoples;replacements.transport=transports;replacements.money=moneys;replacements.service=services;replacements.hotel=hotels;replacements.buyer=buyer;if(additional){$.each(additional,function(i,e){if(typeof e[0][0]!=='undefined'){$.each(e[0],function(_i,_e){e[0][_i]=_e[0];});}
replacements[i]=e[0];});}
$.each(replacements,function(i,e){if(e){if(typeof e[0]==='undefined'){samo_tourist_claim._replace('.'+i+'_info',e);}else{samo_tourist_claim._replace_each('.'+i+'_info',e);}}});$('.claim_main_info',samo_tourist_claim._TOURIST_CLAIM).show();samo_tourist_claim.update_claim_main_info('status',samo_tourist_claim._relation('claim_main_info_status',st));samo_tourist_claim.update_claim_main_info('number',common.providerNumber);samo_tourist_claim.update_claim_main_info('price',common.price&&common.currency?common.price+' '+common.currency:false);}catch(e){samo_tourist_claim.message(samo_tourist_claim.msg('claimGenError')+'\n\n'+e,'error');}}else{samo_tourist_claim.message(samo_tourist_claim.msg('claimsNotFound'));}}
samo_tourist_claim.response=function(data){samo_tourist_claim.ajaxStart=false;if(!data){samo_tourist_claim.message(samo_tourist_claim.msg('unknownError'),'error');return;}
if(!samo_tourist_claim.check_data(data))return;if(samo_tourist_claim._ACTION=='tourist_documents'){if(data.documents&&data.documents[0]){var adv={};$.each(data,function(i,e){if(i!='documents'){adv[i]=e;}});samo_tourist_claim._replace_each('.documents_info',data.documents,adv);}else{samo_tourist_claim.message(samo_tourist_claim.msg('documentsNotFound'));}}else if(samo_tourist_claim._ACTION=='tourist_info'||(samo_tourist_claim.AUTH_BY_KEY&&samo_tourist_claim._ACTION=='tourist_auth')){if(!samo_tourist_claim.AUTHED){$('.clone',samo_tourist_claim._TOURIST_CLAIM).remove();samo_tourist_claim.set_auth_text(data.buyer.Name,data.buyer.Email);samo_tourist_claim.show_claim(data);if(data.help){if(data.help.have_instruction){data.help.iu='#';}
samo_tourist_claim._replace('.tourist_claim_help',data.help);$('#authed').removeClass('mini');$('.tourist_claim_help_container').show();}
if(data.pays){samo_tourist_claim.show_pay_variants(data.pays,true);}
samo_tourist_claim.AUTHED=true;}}else if(samo_tourist_claim._ACTION=='tourist_full_claim_list'){if(data&&data[0]){var show_to=false;$.each(data,function(i,e){e.cdate=samo_tourist_claim._date_format(e.cdate,true);e.condition=samo_tourist_claim._claim_condition(e.condition);e.status=samo_tourist_claim._claim_status(e.status);e.payStatus=samo_tourist_claim._claim_paystatus(e.payStatus);e.provider=e.operator?e.operator:null;e.odd=i%2==0?'claim_list_odd':'';if(e.provider){show_to=true;}});if(data.length>samo.settings.tourist_claim.CLAIM_COUNT_FOR_SCROLLER){$('#claim_list_info_scroller',samo_tourist_claim._TOURIST_CLAIM).addClass('claim_list_info_scroller');}else{$('#claim_list_info_scroller',samo_tourist_claim._TOURIST_CLAIM).removeClass('claim_list_info_scroller');}
samo_tourist_claim._switch_element('.showhide_provider',show_to);samo_tourist_claim._replace_each('.claim_list_info',data);var form=$('.claim_list_info',samo_tourist_claim._TOURIST_CLAIM).filter('.clone');samo_tourist_claim.CLAIM_LIST=form.html();form.remove();samo_tourist_claim.show_claim_list();}}else if(samo_tourist_claim._ACTION=='tourist_claim_info'){samo_tourist_claim.show_claim(data);}else if(samo_tourist_claim._ACTION=='tourist_pay'){samo_tourist_claim.show_pay_variants(data);}else if(samo_tourist_claim._ACTION=='tourist_document_url'){if(data.url){window.open(data.url);}else{samo_tourist_claim.message(samo_tourist_claim.msg('documentURLNotFound'),'error');}}else if(samo_tourist_claim._ACTION=='tourist_logout'){window.location.href=samo.settings.tourist_claim.LOGOUT_URL;}else if(samo_tourist_claim._ACTION=='tourist_instruction'){samo_tourist_claim.INSTRUCTION=data.text;setSamoInstruction(samo_tourist_claim.INSTRUCTION);samo_tourist_claim.show_instruction();}
if(samo_tourist_claim._DOFUNC){setTimeout(function(){samo_tourist_claim._DOFUNC();samo_tourist_claim._DOFUNC=null;},100);}}
samo_tourist_claim.show_claim_list=function(){samo_tourist_claim.show_form(samo_tourist_claim.CLAIM_LIST,'claim_list_form');}
samo_tourist_claim.show_instruction=function(){showSamoInstruction();}
samo_tourist_claim.show_pay_variants=function(data,quick){if(data[0]){if(quick){samo_tourist_claim._NOSLIDE=true;}
samo_tourist_claim._replace_each('.pay_info',data,true);samo_tourist_claim._NOSLIDE=false;$('.do_pay',samo_tourist_claim._TOURIST_CLAIM).each(function(){if($(this).attr('samo:url')==''&&!$(this).find('form').size()){$(this).removeClass('clickable');}
$(this).find('form').hide();});}else{samo_tourist_claim.message(samo_tourist_claim.msg('paysNotFound'));}}
samo_tourist_claim._people_fields=function(e){e.pgiven=samo_tourist_claim._date_format(e.pgiven);e.pexpire=samo_tourist_claim._date_format(e.pexpire);e.human=samo_tourist_claim._relation('people_human',e.human);e.born=samo_tourist_claim._date_format(e.born);e.sex=samo_tourist_claim._relation('people_sex',e.sex);e.age=samo_tourist_claim._relation('people_age',e.age);return e;}
samo_tourist_claim._val=function(val){return val?val:'';}
samo_tourist_claim._clone_template=function(obj){obj=$(obj);var _obj=obj.clone();_obj.addClass('clone');obj.after(_obj);if(_obj.is('.slide')&&!samo_tourist_claim._NOSLIDE){_obj.slideDown();}else{_obj.show();}
return _obj;}
samo_tourist_claim.__replace=function(html,replaces){if(html){var pattern=null;var str='';for(var i_=0;i_<2;i_++){if(i_){pattern=/%7B%.*?%%7D/g;}else{pattern=/{%(.*?)%}/g;}
str=html.match(pattern);if(str){$.each(str,function(i,e){var ___e=e;$.each(replaces,function(__i,__e){if(typeof __e!='object'){var val=samo_tourist_claim._val(__e);var ind=e.indexOf(__i);if(val&&ind>-1){var nextChar=e.charAt(ind+__i.length);var prevChar=e.charAt(ind-1);if(i_||(!samo_tourist_claim._is_eng(nextChar)&&!samo_tourist_claim._is_eng(prevChar))){e=e.replace(__i,val);e=e.substring(i_?4:2,e.length-(i_?4:2));html=html.replace(___e,e);}}}});});}}
html=html.replace(/{%.*?%}/g,'');html=html.replace(/%7B%.*?%%7D/g,'');}
return html;}
samo_tourist_claim._replace=function(container,replaces,no_clone){var attrs=['samo:inc','samo:url','samo:id','samo:peopleKey','samo:people_list','samo:is_form','class'];container=$(container);if(container.is('.clone')){return;}
$.each(container,function(_i,_e){if(!no_clone){_e=samo_tourist_claim._clone_template(_e);}
_e=$(_e);var html=_e.html();html=samo_tourist_claim.__replace(html,replaces);_e.html(html);$.each(attrs,function(i,e){var val=_e.attr(e);if(val){val=samo_tourist_claim.__replace(val,replaces);_e.attr(e,val);}});samo_tourist_claim._end_replace(_e);});}
samo_tourist_claim._end_replace=function(_e){_e.find('a').each(function(___i,___e){___e=$(___e);if(___e.attr('href')==''){if(___e.is('.can_be_empty')){___e.remove();}
___e.replaceWith(___e.text());}});_e.find('.can_be_empty').each(function(___i,___e){___e=$(___e);if(___e.text()==''){___e.parent().hide();}});}
samo_tourist_claim._is_eng=function(val){return val.match(/[a-zA-Z_]/g);}
samo_tourist_claim._replace_each=function(container,replaces,adv){container=$(container);$.each(container,function(_i,_e){_e=samo_tourist_claim._clone_template(_e);_e=$(_e);var element=_e.find('._element:first');var _element=element.clone();var el=null;$.each(replaces,function(i,e){var _el=!i?element:_element.clone();if(e){samo_tourist_claim._replace(_el,e,true);if(i){el.after(_el);}}
el=_el;});if(adv){_e.html(samo_tourist_claim.__replace(_e.html(),adv));samo_tourist_claim._end_replace(_e);}});}
samo_tourist_claim._switch_element=function(sel,show){sel=$(sel);if(show){sel.show();}else{sel.hide();}}
samo_tourist_claim._date_format=function(val,time){if(!val)return'';val=val.split('-');if(time){time=val[2].split(' ');if(time.length==1){time=time[0].split('T');}
if(time.length==2){time=time[1].split(':');}else{time=false;}}
val=val[2].substring(0,2)+'.'+val[1]+'.'+val[0]+(time?(' в '+time[0]+':'+time[1]):'');return val;}
samo_tourist_claim._relation=function(name,val,def){var rel=samo.settings.lang[name];if(val){return rel[val]?rel[val]:(def?def:val);}
return rel.unknown;}
samo_tourist_claim._claim_paystatus=function(val){if(typeof val==='number'){switch(val){case 1:val='psNotPaid';break;case 2:val='psPartiallyPaid';break;case 3:val='psPaid';break;case 4:val='psPenalty';break;case 5:val='psPartiallyPaidPenalty';break;case 6:val='psPaidPenalty';break;}}
return'<span class="paystatus_'+val.toLowerCase().substring(2,0xFF)+'">'+samo_tourist_claim._relation('claim_paystatus',val)+'</span>';}
samo_tourist_claim._claim_condition=function(val){if(typeof val==='number'){switch(val){case 0:val='ccOffer';break;case 1:val='ccPrebooking';break;case 2:val='ccAwaiting';break;case 3:val='ccBooked';break;case 4:val='ccRefusal';break;}}
return'<span class="condition_'+val.toLowerCase().substring(2,0xFF)+'">'+samo_tourist_claim._relation('claim_condition',val)+'</span>';}
samo_tourist_claim._claim_status=function(val){if(typeof val==='number'){switch(val){case 0:val='csNotActivated';break;case 1:val='csNotReaded';break;case 2:val='csProcessed';break;case 3:val='csUnconfirmed';break;case 4:val='csConfirmed';break;case 5:val='csCancelled';break;case 6:val='csAwaitingCancel';break;}}
return'<span class="status_'+val.toLowerCase().substring(2,0xFF)+'">'+samo_tourist_claim._relation('claim_status',val)+'</span>';}
samo_tourist_claim._get_people_list=function(node){var arr=[];if(node){$.each(node,function(i,e){arr[i]=e.peopleKey;});}
return[arr.join(','),arr.length];}
samo_tourist_claim._find_parent_element=function(obj){obj=$(obj);var $p=obj;var finded=false;do{if($p.is('._element')){finded=true;break;}
if($p.get(0).tagName=='BODY'){break;}}while($p=$p.parent());$p=finded?$p:obj;return $p;}
samo_tourist_claim.logout=function(){if(!samo_tourist_claim._TOURIST_CLAIM_FAST&&!samo_tourist_claim.AUTH_BY_KEY){samo_tourist_claim._login_show_loading();$('.clone',samo_tourist_claim._TOURIST_CLAIM).remove();$('.hidden',samo_tourist_claim._TOURIST_CLAIM).hide();$.loadData('tourist_logout');}}
samo_tourist_claim._login_show_loading=function(hide){if(hide){$('#authed #loading_title',samo_tourist_claim._TOURIST_CLAIM).hide();$('#authed #content_title',samo_tourist_claim._TOURIST_CLAIM).show();}else{$('#auth',samo_tourist_claim._TOURIST_CLAIM).hide();$('#authed',samo_tourist_claim._TOURIST_CLAIM).show();$('#authed #loading_title',samo_tourist_claim._TOURIST_CLAIM).show();$('#authed #content_title',samo_tourist_claim._TOURIST_CLAIM).hide();}}
samo_tourist_claim.login=function(){var key=samo_tourist_claim._PARAMS['key'];var email=samo_tourist_claim._PARAMS['email'];samo_tourist_claim.AUTH_BY_KEY=key&&email;if(!samo_tourist_claim.AUTHED){samo_tourist_claim._login_show_loading();}
if(!samo_tourist_claim.AUTH_BY_KEY){$('#authed',samo_tourist_claim._TOURIST_CLAIM).show();}
if(samo_tourist_claim.AUTH_BY_KEY){$('#authed_logout',samo_tourist_claim._TOURIST_CLAIM).remove();$.loadData('tourist_auth',{KEY:key,EMAIL:email,pay:samo_tourist_claim._PARAMS['pay']});}else{$.loadData('tourist_info',{pay:samo_tourist_claim._PARAMS['pay']});}}
samo_tourist_claim.show_form=function(form,addClass){var $form=$('#popup_form',samo_tourist_claim._TOURIST_CLAIM);$form.removeAttr('class');$form.html('');if(addClass){$form.addClass(addClass);}
var $veil=$('#veil',samo_tourist_claim._TOURIST_CLAIM);if(typeof form=='object'){form.attr('target','_blank');form.bind('submit',function(){setTimeout(samo_tourist_claim.hide_form,500);return true;});form.show();}
$form.append(form);$form.find('.close_pay_form, .close_form').removeAttr('disabled');if(document.all){$veil.show();}else{$veil.fadeIn();}
$form.fadeIn();samo_tourist_claim.window_on_scroll();samo_tourist_claim.window_on_scroll();}
samo_tourist_claim.hide_form=function(){var $form=$('#popup_form',samo_tourist_claim._TOURIST_CLAIM);var $veil=$('#veil',samo_tourist_claim._TOURIST_CLAIM);$veil.hide();$form.hide();$form.html('');return true;}
$(document).ready(function(){var url=window.location.href.split('/');url=url[url.length-1];url=url.substring(url.indexOf('?')+1);url=url.split('&');$.each(url,function(i,e){e=e.split('=');samo_tourist_claim._PARAMS[e[0]]=e[1];});samo_tourist_claim._TOURIST_CLAIM.delegate('.people_list','click',function(){var list=$(this).attr('samo:people_list').split(',');var only_clear=false;var $p=samo_tourist_claim._find_parent_element($(this));if($p.is('.highlight')){only_clear=true;}
$('.people, ._element, .people_list',samo_tourist_claim._TOURIST_CLAIM).removeClass('highlight');if(!only_clear){$p.addClass('highlight');var flag=false;$.each($('.people'),function(){if($.inArray($(this).attr('samo:peopleKey'),list)!=-1){$p=samo_tourist_claim._find_parent_element($(this));$p.addClass('highlight');if(!flag){$(this).get(0).scrollIntoView();flag=true;}}});}});samo_tourist_claim._TOURIST_CLAIM.delegate('.show_documents','click',function(){var d=$('.documents_info',samo_tourist_claim._TOURIST_CLAIM).filter('.clone');if(d.size()){samo_tourist_claim.remove_replacers();return;}
samo_tourist_claim.remove_replacers();$.loadData('tourist_documents',{CLAIM:samo_tourist_claim._CLAIM,AGENT:samo_tourist_claim._AGENT});});samo_tourist_claim._TOURIST_CLAIM.delegate('.show_pay','click',function(){var d=$('.pay_info',samo_tourist_claim._TOURIST_CLAIM).filter('.clone');if(d.size()){samo_tourist_claim.remove_replacers();return;}
samo_tourist_claim.show_pays();});samo_tourist_claim._TOURIST_CLAIM.delegate('.replacer_close','click',function(){samo_tourist_claim.remove_replacers();});samo_tourist_claim._TOURIST_CLAIM.delegate('.clickable a','click',function(e){samo_tourist_claim.A_CLICK=true;return true;});samo_tourist_claim._TOURIST_CLAIM.delegate('.do_pay','click',function(){if(samo_tourist_claim.A_CLICK){samo_tourist_claim.A_CLICK=false;return;}
var $form=$(this).find('form');if($form.size()){if($form.attr('samo:show')!=''){samo_tourist_claim.show_form($form.clone());}else{$form.find('input[type=submit]').remove();$form.attr('target','_blank').attr('method','POST').submit();}}else{if($(this).attr('samo:url')!=''){window.open($(this).attr('samo:url'));}}});samo_tourist_claim._TOURIST_CLAIM.delegate('.download_document','click',function(){$.loadData('tourist_document_url',{DOCUMENTID:$(this).attr('samo:id'),EMAIL:samo_tourist_claim._EMAIL,CLAIM:samo_tourist_claim._CLAIM,AGENT:samo_tourist_claim._AGENT});});samo_tourist_claim._TOURIST_CLAIM.delegate('a.instruction','click',function(){if(!samo_tourist_claim.INSTRUCTION){$.loadData('tourist_instruction');}else{samo_tourist_claim.show_instruction();}
return false;});samo_tourist_claim._TOURIST_CLAIM.find('#authed_logout').bind('click',function(){samo_tourist_claim.logout();});samo_tourist_claim._TOURIST_CLAIM.find('#tourist_auth').bind('click',function(){samo_tourist_claim.tourist_claim_auth();return false;});samo_tourist_claim._TOURIST_CLAIM.delegate('.clickable','mouseover mouseout',function(e){$('.clickable',samo_tourist_claim._TOURIST_CLAIM).removeClass('clickable_on').removeClass('clickable_on_show_claim');if(e.type=='mouseover'&&!$(this).is('.selected_claim')){if(!$(this).is('.show_claim')){$(this).addClass('clickable_on');}else{$(this).addClass('clickable_on_show_claim');}}});$(window).bind('scroll resize',function(){samo_tourist_claim.window_on_scroll();});samo_tourist_claim.window_on_scroll=function(){var $form=$('#popup_form',samo_tourist_claim._TOURIST_CLAIM);var $veil=$('#veil',samo_tourist_claim._TOURIST_CLAIM);var y=parseInt(document.body.scrollTop);var wndWidth=$(window).width();var wndHeight=$(window).height();var formWidth=$form.outerWidth();var formHeight=$form.outerHeight();var cont=$form.find('.form_container');cont=cont.size()?cont:$form;if(formWidth>wndWidth*0.8){formWidth=Math.round(wndWidth*0.8);cont.css({overflowX:'auto',width:formWidth+'px'});}
if(formHeight>wndHeight*0.8){formHeight=Math.round(wndHeight*0.8);cont.css({overflowY:'auto',height:formHeight+'px'});}
y+=Math.round(wndHeight/2-formHeight/2);var x=Math.round(wndWidth/2-formWidth/2);$form.css('top',y+'px').css('left',x+'px');$veil.css('height',$(document).height()+'px');}
samo_tourist_claim._TOURIST_CLAIM.delegate('.close_pay_form, .close_form','click',function(){samo_tourist_claim.hide_form();return false;});samo_tourist_claim._TOURIST_CLAIM.delegate('.show_claim','click',function(){var hide=$(this).is('.selected_claim');$('.selected_claim',samo_tourist_claim._TOURIST_CLAIM).removeClass('selected_claim');if(!hide){samo_tourist_claim._find_parent_element($(this)).addClass('selected_claim');samo_tourist_claim._CLAIM=$(this).attr('samo:inc');$.loadData('tourist_claim_info',{CLAIM:samo_tourist_claim._CLAIM,AGENT:samo_tourist_claim._AGENT});}});samo_tourist_claim._TOURIST_CLAIM.delegate('.show_all_claims','click',function(){if(!samo_tourist_claim.CLAIM_LIST){$.loadData('tourist_full_claim_list');}else{samo_tourist_claim.show_claim_list();}});samo_tourist_claim._TOURIST_CLAIM.find('#veil').bind('click',samo_tourist_claim.hide_form);if(!samo_tourist_claim._TOURIST_CLAIM_FAST){samo_tourist_claim.login();}});